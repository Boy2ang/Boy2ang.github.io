<!-- build time:Tue Nov 03 2020 11:32:04 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.lug.ustc.edu.cn/css?family=Monda:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://Boy2ang.github.io").hostname,root:"/",scheme:"Gemini",version:"7.6.0",exturl:!1,sidebar:{position:"left",display:"post",padding:66,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="设计模式系统学习七大原则速记：开口合里特单依设计模式实现需要遵守以下原则"><meta property="og:type" content="article"><meta property="og:title" content="设计模式"><meta property="og:url" content="https://boy2ang.github.io/posts/803106689/index.html"><meta property="og:site_name" content="HELP ME HELP YOU"><meta property="og:description" content="设计模式系统学习七大原则速记：开口合里特单依设计模式实现需要遵守以下原则"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://ybvip.oss-cn-shanghai.aliyuncs.com/blog/1576636408964.png"><meta property="og:image" content="https://ybvip.oss-cn-shanghai.aliyuncs.com/blog/1576633415527.png"><meta property="og:image" content="https://ybvip.oss-cn-shanghai.aliyuncs.com/blog/1576637685142.png"><meta property="og:image" content="https://ybvip.oss-cn-shanghai.aliyuncs.com/blog/1576722599550.png"><meta property="og:image" content="https://ybvip.oss-cn-shanghai.aliyuncs.com/blog/1576744283673.png"><meta property="og:image" content="https://ybvip.oss-cn-shanghai.aliyuncs.com/blog/1576744458688.png"><meta property="og:image" content="https://ybvip.oss-cn-shanghai.aliyuncs.com/blog/1576749101780.png"><meta property="og:image" content="https://ybvip.oss-cn-shanghai.aliyuncs.com/blog/1577064115158.png"><meta property="og:image" content="https://ybvip.oss-cn-shanghai.aliyuncs.com/blog/1577069470978.png"><meta property="og:image" content="https://ybvip.oss-cn-shanghai.aliyuncs.com/blog/1577072320143.png"><meta property="og:image" content="https://ybvip.oss-cn-shanghai.aliyuncs.com/blog/1586856884138.png"><meta property="article:published_time" content="2020-05-20T03:13:04.202Z"><meta property="article:modified_time" content="2020-05-20T08:31:17.502Z"><meta property="article:author" content="YB"><meta property="article:tag" content="设计模式"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://ybvip.oss-cn-shanghai.aliyuncs.com/blog/1576636408964.png"><link rel="canonical" href="https://boy2ang.github.io/posts/803106689/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,isPage:!1,isArchive:!1}</script><title>设计模式 | HELP ME HELP YOU</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">HELP ME HELP YOU</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">记录人生的点点滴滴</p></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">21</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">19</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">28</span></a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-fw fa-heartbeat"></i>公益 404</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><a href="https://github.com/Boy2ang" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://boy2ang.github.io/posts/803106689/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="YB"><meta itemprop="description" content="年岁是我的闹钟"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HELP ME HELP YOU"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">设计模式</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-05-20 03:13:04 / 修改时间：08:31:17" itemprop="dateCreated datePublished" datetime="2020-05-20T03:13:04Z">2020-05-20</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">设计模式</span> </a></span></span><span id="/posts/803106689/" class="post-meta-item leancloud_visitors" data-flag-title="设计模式" title="热度"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">热度：</span> <span class="leancloud-visitors-count"></span> <span>℃</span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/posts/803106689/#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/posts/803106689/" itemprop="commentCount"></span></a></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>26k 字</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>24 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><hr><h1>设计模式系统学习</h1><h2 id="七大原则">七大原则</h2><p>速记：<code>开口合里特单依</code></p><p>设计模式实现需要遵守以下原则</p><a id="more"></a><!-- more --><escape>### 1.单一职责原则 介绍 - 对类来说：一个类只能负责一个职责 - 举例：`TeacherDao`和`StudentDao` 两个类职责分明 - 通常情况下我们需要遵循单一职责原则。如果当逻辑足够简单，类中的方法较少，可以考虑违反单一职责原则，在方法级别保持单一职责原则 ### 2.接口隔离原则 介绍 - 客户端不应该依赖它不需要的接口，即一个类对另一个类的依赖应该建立在最小的接口上 - 个人理解： - 一个类如果需要使用到一些方法，那么这个类可以通过依赖一个满足这些方法的接口，通过这个接口来调用实现这个接口的实现类。 - 类依赖的这个接口中的所有方法都必须是服务于这个类的，不能出现其他多余的方法，如果出现了，要将这些方法抽取出去变成其他的接口。 - 他人解释： 接口隔离原则表明客户端不应该被强迫实现一些他们不会使用的接口，应该把胖接口中的方法分组，然后用多个接口代替它，每个接口服务于一个子模块。 - 单一职责感觉和接口隔离感觉很像 区别： 前者针对单个类的,后者针对类之间的依赖耦合关系。 ### 3.依赖倒转原则 介绍 - 高层模块不应该依赖底层模块，二者都应该依赖其抽象 - 抽象不应该依赖细节，细节应该依赖抽象 - 在Java中，抽象指的是接口或抽象类，细节就是具体的实现类 - 使用接口和抽象类的目的是制定好规范，而不设计任何具体的实现，把展示细节的任务交给他们的实现类完成 依赖关系传递的三种方式 - 接口传递 - 构造方法传递 - setter方式传递 ### 4.里氏替换原则 前言：关于继承 - 父类中凡是已经实现好的方法，实际上是在设定规范和契约，虽然他不强制要求所有的子类必须遵守这些契约，但是如果子类对这些已经实现的方法任意修改，就会对整个继承体系造成破坏 - 所以如何正确的使用继承？ 提出了里氏替换原则 介绍 - 1988年麻省理工一位姓里的女士提出 - 所有引用基类的地方必须能透明地使用其子类的对象（就是不要重写父类的方法） - 在使用继承时，遵循里氏替换原则，在子类中尽量不要重写父类的方法 - 继承实际上让两个类耦合性增强了，在适当的情况下，可以通过聚合，组合，依赖来解决问题 ### 5.开闭原则 介绍 - 开闭原则是编程中最基础、最重要的设计原则 - 一个软件实体如类，模块和函数应该对扩展开放（服务方很简单的新增功能），对修改关闭（使用方不需更改使用方式）。用抽象构建框架，用实现扩展细节 - 当软件需要变化时，尽量通过扩展软件实体的行为来实现变化，而不是通过修改已有的代码来实现变化 - 编程中遵循其他原则，以及使用设计模式的目的就是遵循开闭原则。 ### 6.迪米特法则 介绍 - 最少知道原则，即一个类对自己依赖的类知道的越少越好 - 更简单的定义：只与直接的朋友通信 - 直接的朋友： - 只要两个对象之间有耦合关系，我们就说这两个对象之间是朋友关系。 - 耦合的方式有很多种：依赖，关联，组合，聚合等 - 我们称出现成员变量，方法参数，方法返回值中的类为直接的朋友，而出现在局部变量的类不是直接朋友。 - 例如类A中有个`private B b = new B()` 的成员变量，则称B为A的直接朋友 - 陌生的类最好不要以局部变量的形式出现在类的内部 ### 7.合成复用原则 介绍 - 尽量使用合成/聚合的方式，而不是使用继承 ### 总结：设计原则核心思想 - 找出应用中可能需要变化之处，把他们独立出来，不要和那些不需要变化的代码混在一起 - 针对接口编程，而不是针对实现编程 - 为了交互对象之间的松耦设计而努力 ## UML类图 ### 1.依赖关系(dependence) ![](https://ybvip.oss-cn-shanghai.aliyuncs.com/blog/1576579693768.png) 只要在类中用到了对方，那么他们之间就存在依赖关系 - 类中用到了对方 - 是类的成员属性 - 方法的返回类型 - 方法接收的参数类型 - 方法中使用到 ### 2.泛化关系（generalization） ![](https://ybvip.oss-cn-shanghai.aliyuncs.com/blog/1576580257492.png) 泛化关系实际上就是继承关系，他是依赖关系的特例 - 如果A类继承了B类，我们就说A和B存在泛化关系 ### 3.实现(implementation) ![](https://ybvip.oss-cn-shanghai.aliyuncs.com/blog/1576580701533.png) - A类实现B类接口 ### 4.关联关系（associate） ![](https://ybvip.oss-cn-shanghai.aliyuncs.com/blog/1576582023032.png) 类与类之间的联系，他是依赖关系的特例 - 关系具有导航性：即双向关系或单向关系 - 关系具有多重性：如`1`(有且仅有一个)，`0...`(表示0个或多个)，`0,1`(表示0个或者一个)，`n...m`(表示n到m个都可以)，`m...*`(表示至少m个) - 单向一对一关系 - 双向一对一关系 - 一对多，多对多， 单双向等等... ### 5.聚合关系（aggregation） ![](https://ybvip.oss-cn-shanghai.aliyuncs.com/blog/1576580986423.png) 表示整体和部分的关系，整体和部分可以分开 聚合关系是关联关系的特例，所以他具有导航性与多重性 （例如：成员变量即关联，具有导航性和多重性） - 一台电脑由键盘，鼠标等组成 - 组成电脑的各个部件可以从电脑上分离出来，使用带空心菱形来表示 ### 6.组合关系（composition） ![](https://ybvip.oss-cn-shanghai.aliyuncs.com/blog/1576581210226.png) 表示整体和部分的关系，但是整体和部分不可以分开 - 一个案例，人和身份证和脑袋，人和身份证属于聚合，因为即使身份证掉了分开了可以补办，人和脑袋属于组合，不能分开 - 特例：如果班级和班上的同学，本来属于组合，但是如果班级和同学定义了级联删除，即删除一个班就要删除整个班的所有信息，那么班级和同学就属于组合关系了 ## 设计模式 金句：`懂了设计模式，你就懂了面向对象分析和设计（OOA/D）的精要` 设计模式的目的 也就是说设计模式有以下优点： - 1.代码重用性（相同的代码不需要多次编写） - 2.可读性（编程规范，编译程序员阅读） - 3.可扩展（维护）性（增加新的功能时，非常的方便） - 4.可靠性（增加新的功能对原来的功能没有影响） - 5.高内聚低耦合 分类 - 创建型模式：单例模式模式、抽象工厂模式模式、原型模式、建造者模式、工厂模式 - 结构型：适配器模式、桥接模式、装饰模式、组合模式、外观模式、享元模式、代理模式 - 行为型：模板方式模式、命令模式、访问者模式、迭代器模式、观察者模式、中介者模式、备忘录模式、解释器模式、状态模式、策略模式、策略职责链模式 ### 1.单例设计模式 介绍：采取一定的方法保证在整个软件系统中，对某个方法只能存在一个对象实例，并且该类只提供一个取得其对象实例的方法（静态方法）。 比如Hibernate的`SessionFactory`，它充当数据源的代理，并负责创建Session对象，`SessionFactory`并不是轻量级的，一般情况下，一个项目只需要一个`SessionFactory`就够了，这时就会使用到单例模式 #### * 饿汉式（2种，推荐） 注意：如果使用饿汉式，就要保证其能够被用到，否则造成内存浪费 ##### 静态常量 基本步骤 - 构造器私有化(防止new) - 类的内部创建对象 - 向外暴露一个静态的公共方法 `getInstance` 代码<escape><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> type1;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CREATE BY YB ON 2019/12/17 14:34</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test01</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Singleton instance1 = Singleton.getInstance();</span><br><span class="line">        Singleton instance2 = Singleton.getInstance();</span><br><span class="line">        System.out.println(instance1==instance2);</span><br><span class="line"></span><br><span class="line">        System.out.println(instance1.hashCode());</span><br><span class="line">        System.out.println(instance2.hashCode());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 饿汉式（静态变量）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span></span>&#123;</span><br><span class="line">    <span class="comment">// 1.构造器私有化</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="comment">// 2.本类内部创建对象实例</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Singleton instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">    <span class="comment">// 3.提供一个公有的静态方法，返回实例对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>优缺点：</p><ul><li>优点：写法简单，类装载时完成实例化，避免线程同步问题</li><li>缺点：类装载时完成实例化，没有达到Lazy Loading的效果，如果实例化了却没有使用，造成内存浪费</li><li>结论：可用，可能造成内存浪费</li></ul><h5 id="静态代码块">静态代码块</h5><p>和静态变量优缺点一样，只不过换种写法而已</p><p>代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> type2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CREATE BY YB ON 2019/12/17 14:34</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test02</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Singleton instance1 = Singleton.getInstance();</span><br><span class="line">        Singleton instance2 = Singleton.getInstance();</span><br><span class="line">        System.out.println(instance1==instance2);</span><br><span class="line"></span><br><span class="line">        System.out.println(instance1.hashCode());</span><br><span class="line">        System.out.println(instance2.hashCode());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 饿汉式（静态代码块）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span></span>&#123;</span><br><span class="line">    <span class="comment">// 1.构造器私有化</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.本类内部创建对象实例</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        instance = <span class="keyword">new</span> Singleton(); <span class="comment">// 在静态代码块中，创建单例对象</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.提供一个公有的静态方法，返回实例对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="懒汉式（3种）">* 懒汉式（3种）</h4><h5 id="懒汉式（线程不安全）">懒汉式（线程不安全）</h5><p>优缺点：</p><ul><li>起到了Lazy Loading的效果，但是只能在单线程下运行</li><li>如果在多线程中，一个线程进入<code>if (instance == null)</code>，还没来得急创建实例，第二个线程又进来了，导致会产生多个实例</li><li>结论：在实际开发中，不要使用这种方式</li></ul><p>代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> type3;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CREATE BY YB ON 2019/12/17 15:04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test03</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"懒汉式第一种：线程不安全"</span>);</span><br><span class="line">        Singleton instance1 = Singleton.getInstance();</span><br><span class="line">        Singleton instance2 = Singleton.getInstance();</span><br><span class="line">        System.out.println(instance1 == instance2);</span><br><span class="line">        System.out.println(instance1.hashCode());</span><br><span class="line">        System.out.println(instance2.hashCode());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 懒汉式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 提供一个静态公有方法，使用到才创建instance ,用到才创建--懒汉式</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="懒汉式（线程安全）">懒汉式（线程安全）</h5><p>优缺点：</p><ul><li>解决了线程不安全问题</li><li>效率太低了，每个线程在想获得类的实例的时候，都要同步等待</li><li>结论：实际开发中不推荐</li></ul><p>代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> type4;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CREATE BY YB ON 2019/12/17 15:04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test04</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"懒汉式第二种：线程安全"</span>);</span><br><span class="line">        Singleton instance1 = Singleton.getInstance();</span><br><span class="line">        Singleton instance2 = Singleton.getInstance();</span><br><span class="line">        System.out.println(instance1 == instance2);</span><br><span class="line">        System.out.println(instance1.hashCode());</span><br><span class="line">        System.out.println(instance2.hashCode());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 懒汉式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 提供一个静态公有方法，加入同步处理方法，解决线程不安全问题</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="懒汉式（同步代码块，不安全-）">懒汉式（同步代码块，不安全 ）</h5><p>优缺点：</p><ul><li>本意是想对<code>type4</code>的改进，因为同步方法效率太低，改为同步产生实例化的代码块</li><li>但是这种方法根本不能起到线程同步的作用，可能多个线程同时进入if中</li><li>结论：实际开发中，不能使用此方法</li></ul><p>代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> type5;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CREATE BY YB ON 2019/12/17 15:04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test05</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"懒汉式第三种：线程不安全"</span>);</span><br><span class="line">        Singleton instance1 = Singleton.getInstance();</span><br><span class="line">        Singleton instance2 = Singleton.getInstance();</span><br><span class="line">        System.out.println(instance1 == instance2);</span><br><span class="line">        System.out.println(instance1.hashCode());</span><br><span class="line">        System.out.println(instance2.hashCode());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 懒汉式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 同步代码块，解决type4同步效率问题(type4每个线程都需要等待)，</span></span><br><span class="line">    <span class="comment">// 但还是不能解决同步安全问题，比如前面两个线程同时进入if方法，第一个new了实例，第二个线程还是会new实例</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton<span class="class">.<span class="keyword">class</span>) </span>&#123;</span><br><span class="line">                instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="双重检查（推荐）">* 双重检查（推荐）</h4><p>优缺点：</p><ul><li>Double-Check 概念是多线程中经常使用到的，可以保证线程安全</li><li>避免了方法进行方法同步</li><li>线程安全；延迟加载；效率较高</li><li>结论：在实际开发中，推荐使用这种单例设计模式</li></ul><p>代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> type6;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CREATE BY YB ON 2019/12/17 15:04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test06</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"双重检查："</span>);</span><br><span class="line">        Singleton instance1 = Singleton.getInstance();</span><br><span class="line">        Singleton instance2 = Singleton.getInstance();</span><br><span class="line">        System.out.println(instance1 == instance2);</span><br><span class="line">        System.out.println(instance1.hashCode());</span><br><span class="line">        System.out.println(instance2.hashCode());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 注意volatile关键词，现在不是很理解，轻量级的synchronized</span></span><br><span class="line">    <span class="comment">// B站弹幕：双重检查锁虽然线程安全，但是会出现内部成员变量空指针异常，所以需要加上volatile来解决</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Singleton instance;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 解决线程不完全问题，同时解决懒加载问题，还保证了效率</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton<span class="class">.<span class="keyword">class</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="静态内部类（推荐）">* 静态内部类（推荐）</h4><p>优缺点：</p><ul><li>采用了类装载的机制来保证初始化实例时只有一个线程</li><li>静态内部类方式在Singleton类被装载时并不会立即实例化，而是在需要实例化时，调用<code>getInstance</code>方法，才会装载<code>SingletonInstance</code>类，从而完成Singleton的实例化</li><li>类的静态属性只会在第一次加载类的时候初始化，<code>JVM帮</code>助我们保证了线程的安全性，在类进行初始化时，别的类是无法进入的</li><li>优点：避免了线程不安全，利用静态内部类特点实现延迟加载，效率高</li><li>结论：推荐使用</li></ul><p>代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> type7;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CREATE BY YB ON 2019/12/17 15:04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test07</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"静态内部类："</span>);</span><br><span class="line">        Singleton instance1 = Singleton.getInstance();</span><br><span class="line">        Singleton instance2 = Singleton.getInstance();</span><br><span class="line">        System.out.println(instance1 == instance2);</span><br><span class="line">        System.out.println(instance1.hashCode());</span><br><span class="line">        System.out.println(instance2.hashCode());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 静态内部类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造器私有化</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 写一个静态内部类</span></span><br><span class="line">    <span class="comment">// 类初始化是静态内部类不会初始化，延迟加载</span></span><br><span class="line">    <span class="comment">// 而且静态内部类线程也是安全的</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonInstance</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton INSTANCE = <span class="keyword">new</span> Singleton();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 提供一个静态公有方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonInstance.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="枚举（推荐）">* 枚举（推荐）</h4><p>优缺点：</p><ul><li>借助<code>JDK1.5</code>添加的枚举来实现单例。不仅能避免多线程同步问题，而且还能防止反序列化重新创建新的对象</li><li>这种方式是Effective Java作者Josh Bloch提倡的方法</li><li>结论：推荐使用</li></ul><p>代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> type8;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CREATE BY YB ON 2019/12/17 16:23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test08</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Singleton instance1 = Singleton.INSTANCE;</span><br><span class="line">        Singleton instance2 = Singleton.INSTANCE;</span><br><span class="line">        System.out.println(instance1 == instance2);</span><br><span class="line">        System.out.println(instance1.hashCode());</span><br><span class="line">        System.out.println(instance2.hashCode());</span><br><span class="line"></span><br><span class="line">        instance1.sayOk();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用枚举，可以实现单例</span></span><br><span class="line"><span class="keyword">enum</span> Singleton &#123;</span><br><span class="line">    INSTANCE; <span class="comment">// 属性</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayOk</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"OK···"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="具体应用举例">具体应用举例</h4><p><code>JDK</code>的Runtime 类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CREATE BY YB ON 2019/12/17 16:39</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Example_runtime</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 饿汉式</span></span><br><span class="line">        Runtime runtime = Runtime.getRuntime();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Runtime currentRuntime = <span class="keyword">new</span> Runtime();</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Returns the runtime object associated with the current Java application.</span></span><br><span class="line"><span class="comment">    * Most of the methods of class &lt;code&gt;Runtime&lt;/code&gt; are instance</span></span><br><span class="line"><span class="comment">    * methods and must be invoked with respect to the current runtime object.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span>  the &lt;code&gt;Runtime&lt;/code&gt; object associated with the current</span></span><br><span class="line"><span class="comment">    *          Java application.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Runtime <span class="title">getRuntime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> currentRuntime;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="注意事项和细节说明">注意事项和细节说明</h4><ul><li>单例模式保证了系统内存中该类只存在一个对象，节省了系统资源，对于一些需要频繁创建销毁的对象，使用单例可以提高性能</li><li>当想实例化一个单例类的时候，必须要记住使用相应的获取对象的方法，而不是使用new</li><li>单例模式使用场景：<ul><li>需要频繁进行创建和销毁的对象</li><li>创建对象耗时过多或者耗费资源过多（即：重量级对象）但又经常用到的对象</li><li>工具类对象</li><li>频繁访问数据库或文件的对象（如：数据源、session工厂等）</li></ul></li></ul><h3 id="2-工厂模式">2.工厂模式</h3><h4 id="简单工厂模式">* 简单工厂模式</h4><p><img src="https://ybvip.oss-cn-shanghai.aliyuncs.com/blog/1576636408964.png" alt></p><h4 id="工厂方法模式">* 工厂方法模式</h4><p><img src="https://ybvip.oss-cn-shanghai.aliyuncs.com/blog/1576633415527.png" alt></p><p>定义了一个创建对象的抽象方法，由子类决定要实例化的类，工厂方法模式将对象的实例化推迟到子类</p><h4 id="抽象工厂模式">* 抽象工厂模式</h4><p>抽象工厂模式可以将简单工厂模式和工厂方法模式进行整合</p><p><img src="https://ybvip.oss-cn-shanghai.aliyuncs.com/blog/1576637685142.png" alt></p><h4 id="具体应用举例-2">具体应用举例</h4><p><code>JDK</code> 的<code>Calendar</code>，使用了简单工厂模式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Calendar;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CREATE BY YB ON 2019/12/18 12:04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CalendarExample</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Calendar cal = Calendar.getInstance();</span><br><span class="line">        <span class="comment">// 注意月份下标从0开始，所以取月份要+1</span></span><br><span class="line">        System.out.println(<span class="string">"年:"</span> + cal.get(Calendar.YEAR));</span><br><span class="line">        System.out.println(<span class="string">"月:"</span> + (cal.get(Calendar.MONTH) + <span class="number">1</span>));</span><br><span class="line">        System.out.println(<span class="string">"日:"</span> + cal.get(Calendar.DAY_OF_MONTH));</span><br><span class="line">        System.out.println(<span class="string">"时:"</span> + cal.get(Calendar.HOUR_OF_DAY));</span><br><span class="line">        System.out.println(<span class="string">"分:"</span> + cal.get(Calendar.MINUTE));</span><br><span class="line">        System.out.println(<span class="string">"秒:"</span> + cal.get(Calendar.SECOND));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>进入<code>getInstance</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Calendar <span class="title">getInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> createCalendar(TimeZone.getDefault(), Locale.getDefault(Locale.Category.FORMAT));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>进入<code>createCalendar</code></p><p>可以看到switch 就用到了简单工厂，通过不同的类型创建不同的实例对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (aLocale.hasExtensions()) &#123;</span><br><span class="line">            String caltype = aLocale.getUnicodeLocaleType(<span class="string">"ca"</span>);</span><br><span class="line">            <span class="keyword">if</span> (caltype != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">switch</span> (caltype) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">"buddhist"</span>:</span><br><span class="line">                cal = <span class="keyword">new</span> BuddhistCalendar(zone, aLocale);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">"japanese"</span>:</span><br><span class="line">                    cal = <span class="keyword">new</span> JapaneseImperialCalendar(zone, aLocale);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">"gregory"</span>:</span><br><span class="line">                    cal = <span class="keyword">new</span> GregorianCalendar(zone, aLocale);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h4 id="工厂模式总结">工厂模式总结</h4><ul><li>工厂模式的意义：将实例化的代码提取出来，交给工厂维护和管理，达到和主项目的依赖关系的解耦，从而提高项目的扩展和维护性</li><li>三种工厂模式要记住</li></ul><h3 id="3-原型模式">3.原型模式</h3><p>引出问题：</p><p>现在有一只美羊羊，编程程序创建和美羊羊属性完全相同的10只羊</p><h4 id="传统方式">传统方式</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">improve.Wolf wolf = <span class="keyword">new</span> Wolf(<span class="string">"gray"</span>, <span class="string">"灰太狼"</span>);</span><br><span class="line">Sheep sheep = <span class="keyword">new</span> Sheep(<span class="string">"喜羊羊"</span>,<span class="number">18</span>,<span class="string">"白色"</span>,wolf);</span><br><span class="line"></span><br><span class="line">Sheep sheep1 = <span class="keyword">new</span> Sheep(sheep.getName(),sheep.getAge(),sheep.getColor(),sheep.getFriend());</span><br><span class="line">Sheep sheep2 = <span class="keyword">new</span> Sheep(sheep.getName(),sheep.getAge(),sheep.getColor(),sheep.getFriend());</span><br><span class="line">Sheep sheep3 = <span class="keyword">new</span> Sheep(sheep.getName(),sheep.getAge(),sheep.getColor(),sheep.getFriend());</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">System.out.println(sheep + <span class="string">"--hashcode:"</span> + sheep.hashCode()+<span class="string">"，引用类型🐺的hashcode："</span>+sheep.getFriend().hashCode());</span><br><span class="line">System.out.println(sheep1 + <span class="string">"--hashcode:"</span> + sheep1.hashCode()+<span class="string">"，引用类型🐺的hashcode："</span>+sheep1.getFriend().hashCode());</span><br><span class="line">System.out.println(sheep2 + <span class="string">"--hashcode:"</span> + sheep2.hashCode()+<span class="string">"，引用类型🐺的hashcode："</span>+sheep2.getFriend().hashCode());</span><br><span class="line">System.out.println(sheep3 + <span class="string">"--hashcode:"</span> + sheep3.hashCode()+<span class="string">"，引用类型🐺的hashcode："</span>+sheep3.getFriend().hashCode());</span><br></pre></td></tr></table></figure><p>优缺点：</p><ul><li>好理解，容易操作</li><li>创建新对象时，总是需要获取原始对象的属性</li><li>总是需要重新创建，而不是动态获取对象运行时的状态，不够灵活</li><li>属于浅拷贝</li></ul><h4 id="原型模式（浅拷贝）">* 原型模式（浅拷贝）</h4><p>介绍</p><ul><li>用原型实例指定创建对象的种类，并且通过拷贝这些原型，创建新的对象</li><li>原型模式属于创建型设计模式，运行一个对象再创建另一个可定制的对象，无需知道创建的细节</li></ul><p>代码实现</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> improve;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CREATE BY YB ON 2019/12/19 8:53</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sheep</span> <span class="keyword">implements</span> <span class="title">Cloneable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    <span class="keyword">private</span> Wolf friend; <span class="comment">// 🐏的朋友</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Sheep</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Sheep</span><span class="params">(String name, <span class="keyword">int</span> age, String color, Wolf friend)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">        <span class="keyword">this</span>.friend = friend;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getColor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setColor</span><span class="params">(String color)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Wolf <span class="title">getFriend</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> friend;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFriend</span><span class="params">(Wolf friend)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.friend = friend;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Sheep&#123;"</span> +</span><br><span class="line">                <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", age="</span> + age +</span><br><span class="line">                <span class="string">", color='"</span> + color + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", friend="</span> + friend +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重写克隆方法</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Object <span class="title">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">        Object sheep = <span class="keyword">super</span>.clone();</span><br><span class="line">        <span class="keyword">return</span> sheep;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> improve;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CREATE BY YB ON 2019/12/19 9:01</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">        <span class="comment">// 原型模式完成对象的创建</span></span><br><span class="line">        Wolf wolf = <span class="keyword">new</span> Wolf(<span class="string">"gray"</span>, <span class="string">"灰太狼"</span>);</span><br><span class="line">        Sheep sheep = <span class="keyword">new</span> Sheep(<span class="string">"喜羊羊"</span>, <span class="number">18</span>, <span class="string">"白色"</span>,wolf);</span><br><span class="line">        Sheep sheep1 = (Sheep) sheep.clone();</span><br><span class="line">        Sheep sheep2 = (Sheep) sheep.clone();</span><br><span class="line">        Sheep sheep3 = (Sheep) sheep.clone();</span><br><span class="line"></span><br><span class="line">        System.out.println(sheep + <span class="string">"--hashcode:"</span> + sheep.hashCode()+<span class="string">"，引用类型🐺的hashcode："</span>+sheep.getFriend().hashCode());</span><br><span class="line">        System.out.println(sheep1 + <span class="string">"--hashcode:"</span> + sheep1.hashCode()+<span class="string">"，引用类型🐺的hashcode："</span>+sheep1.getFriend().hashCode());</span><br><span class="line">        System.out.println(sheep2 + <span class="string">"--hashcode:"</span> + sheep2.hashCode()+<span class="string">"，引用类型🐺的hashcode："</span>+sheep2.getFriend().hashCode());</span><br><span class="line">        System.out.println(sheep3 + <span class="string">"--hashcode:"</span> + sheep3.hashCode()+<span class="string">"，引用类型🐺的hashcode："</span>+sheep3.getFriend().hashCode());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 结论：此种拷贝，拷贝的每只羊hashcode变了，每只样的引用类型的属性的hashcode没有变了，属于浅拷贝</span></span><br><span class="line"><span class="comment">     * Sheep&#123;name='喜羊羊', age=18, color='白色', friend=Wolf&#123;color='gray', name='灰太狼'&#125;&#125;--hashcode:1163157884，引用类型🐺的hashcode：1956725890</span></span><br><span class="line"><span class="comment">     * Sheep&#123;name='喜羊羊', age=18, color='白色', friend=Wolf&#123;color='gray', name='灰太狼'&#125;&#125;--hashcode:356573597，引用类型🐺的hashcode：1956725890</span></span><br><span class="line"><span class="comment">     * Sheep&#123;name='喜羊羊', age=18, color='白色', friend=Wolf&#123;color='gray', name='灰太狼'&#125;&#125;--hashcode:1735600054，引用类型🐺的hashcode：1956725890</span></span><br><span class="line"><span class="comment">     * Sheep&#123;name='喜羊羊', age=18, color='白色', friend=Wolf&#123;color='gray', name='灰太狼'&#125;&#125;--hashcode:21685669，引用类型🐺的hashcode：1956725890</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> improve;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CREATE BY YB ON 2019/12/19 9:11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Wolf</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Wolf</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Wolf</span><span class="params">(String color, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getColor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setColor</span><span class="params">(String color)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Wolf&#123;"</span> +</span><br><span class="line">                <span class="string">"color='"</span> + color + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="深拷贝">深拷贝</h4><ul><li><p>方式一：继续使用clone方法，克隆引用类型的成员属性</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> Object <span class="title">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		Object deep = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">//这里完成对基本数据类型(属性)和String的克隆</span></span><br><span class="line">		deep = <span class="keyword">super</span>.clone(); </span><br><span class="line">		<span class="comment">//对引用类型的属性，进行单独处理</span></span><br><span class="line">		DeepProtoType deepProtoType = (DeepProtoType)deep;</span><br><span class="line">		deepProtoType.deepCloneableTarget  = (DeepCloneableTarget)deepCloneableTarget.clone();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">return</span> deepProtoType;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></li><li><p>方式二：通过对象的序列化实现 (推荐)</p><p>public Object deepClone() {</p><pre><code>  	//创建流对象
  	ByteArrayOutputStream bos = null;
  	ObjectOutputStream oos = null;
  	ByteArrayInputStream bis = null;
  	ObjectInputStream ois = null;
  	
  	try {
  		
  		//序列化
  		bos = new ByteArrayOutputStream();
  		oos = new ObjectOutputStream(bos);
  		oos.writeObject(this); //当前这个对象以对象流的方式输出
  		
  		//反序列化
  		bis = new ByteArrayInputStream(bos.toByteArray());
  		ois = new ObjectInputStream(bis);
  		DeepProtoType copyObj = (DeepProtoType)ois.readObject();
  		
  		return copyObj;
  		
  	} catch (Exception e) {
  		// TODO: handle exception
  		e.printStackTrace();
  		return null;
  	} finally {
  		//关闭流
  		try {
  			bos.close();
  			oos.close();
  			bis.close();
  			ois.close();
  		} catch (Exception e2) {
  			// TODO: handle exception
  			System.out.println(e2.getMessage());
  		}
  	}
  	
  }
</code></pre><ul><li>序列化是指把对象转换为字节序列的过程,而反序列化是指把字节序列恢复为对象的过程</li><li>利用对象序列化和反序列化，会产生全新的对象的特性来拷贝</li></ul></li></ul><h4 id="具体应用举例-3">具体应用举例</h4><ul><li><p>Spring中创建bean有两种方式，一种是单例，另一种就是原型了</p></li><li><p>代码分析</p><p><img src="https://ybvip.oss-cn-shanghai.aliyuncs.com/blog/1576722599550.png" alt></p></li><li><pre><code class="language-xml">&lt;bean id=&quot;id01&quot; class=&quot;com.bdqn.prototype.bean.Monster&quot; scope=&quot;prototype&quot;&gt;&lt;/bean&gt;
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- ````java</span><br><span class="line">  <span class="built_in">public</span> <span class="keyword">class</span> ProtoTypeTest &#123;</span><br><span class="line">  	<span class="built_in">public</span> static <span class="type">void</span> main(String[] args) &#123;</span><br><span class="line">  		ApplicationContext applicationContext = <span class="built_in">new</span> ClassPathXmlApplicationContext("applicationContext.xml");</span><br><span class="line">  		</span><br><span class="line">  		<span class="keyword">Object</span> monster1 = applicationContext.getBean("id01");</span><br><span class="line">  //		<span class="keyword">Object</span> monster2 = applicationContext.getBean("id01");</span><br><span class="line">  //		<span class="keyword">Object</span> monster3 = applicationContext.getBean("id01");</span><br><span class="line">  		</span><br><span class="line">  		// 每个bean实例都不一样</span><br><span class="line">  		<span class="keyword">System</span>.<span class="keyword">out</span>.println(monster1.hashCode());</span><br><span class="line">  //		<span class="keyword">System</span>.<span class="keyword">out</span>.println(monster2.hashCode());</span><br><span class="line">  //		<span class="keyword">System</span>.<span class="keyword">out</span>.println(monster3.hashCode());</span><br><span class="line">  	&#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

</code></pre></li><li><p>通过测试得知Spring的原型创建bean为深拷贝</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">int</span>[] beauty = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 测试Spring 原型模式属于什么拷贝（深还是浅，通过判断成员变量引用类型是否相等）</span></span><br><span class="line">		<span class="comment">// hashcode不一样，说明深拷贝</span></span><br><span class="line">		System.out.println(monster1);</span><br><span class="line">		System.out.println(monster2);</span><br><span class="line">		System.out.println(<span class="string">"------------------"</span>);</span><br><span class="line">		System.out.println(monster1.beauty.hashCode());</span><br><span class="line">		System.out.println(monster2.beauty.hashCode());</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用原型模式创建bean --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"id01"</span> <span class="attr">class</span>=<span class="string">"com.bdqn.prototype.bean.Monster"</span> <span class="attr">scope</span>=<span class="string">"prototype"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Monster [<span class="attribute">id</span>=1, <span class="attribute">nickName</span>=蔡徐坤, <span class="attribute">skill</span>=打篮球, beauty=[1, 2, 3]]</span><br><span class="line">Monster [<span class="attribute">id</span>=1, <span class="attribute">nickName</span>=蔡徐坤, <span class="attribute">skill</span>=打篮球, beauty=[1, 2, 3]]</span><br><span class="line">------------------</span><br><span class="line">269468037</span><br><span class="line">1681595665</span><br></pre></td></tr></table></figure></li></ul><h4 id="深入讨论—浅拷贝和深拷贝">深入讨论—浅拷贝和深拷贝</h4><p>不管是传统模式还是深浅拷贝，拷贝后的对象的<code>hashCode</code>都是新的，即创建了新对象</p><p>深浅拷贝的区间就是新对象的引用类型的成员变量的<code>hashCode</code>是否和原来的对象是否一样</p><ul><li>浅拷贝<ul><li>对于数据类型是基本数据类型的成员变量（加上String），浅拷贝会直接进行值传递，也就是将属性值复制一份给新的对象</li><li>对于数据类型是引用数据类型的成员变量，比如说某个数组、某个类的对象，浅拷贝会进行引用传递，也就是只是将该成员变量的引用值（内存地址）复制一方给新的对象。因为实际上两个对象的该成员变量都指向同一个实例。在这种情况下，在一个对象中修改该成员对象会影响到另一个对象的该成员变量值</li><li>传统模式的复制和克隆羊都属于浅拷贝</li></ul></li><li>深拷贝<ul><li>复制对象的所有基本类型的成员变量</li><li>为所有引用数据的成员变量申请存储空间，并复制每个引用数据类型成员变量所引用的对象，直到该对象可达的所有对象。也就是说，对象进行深拷贝是要对整个对象（包括对象的引用类型）进行拷贝</li><li>方式一：重写clone方法（需要实现<code>Cloneable</code>）</li><li>方式二：通过对象序列化实现深拷贝（推荐）（需要实现<code>Serializable</code>）</li></ul></li></ul><h4 id="注意事项和细节">注意事项和细节</h4><ul><li>创建新的对象比较复杂时，可以利用原型模式来简化对象的创建过程，同时能够提高效率</li><li>不用重写初始化对象，而是动态的获取对象运行时的状态</li><li>如果原始对象发生变化，其他克隆对象也会发生变化，无须修改</li><li>在实现深克隆可能需要比较复制的代码才能实现</li><li>缺点：需要为每个类配对一个克隆方法，这对全新的类来说不是很难，但对已有的类进行改造时，需要修改其源码，违背了ocp开闭原则</li></ul><h3 id="4-建造者模式">4.建造者模式</h3><h4 id="建造者模式的四个角色">建造者模式的四个角色</h4><ul><li>Product（产品角色）</li><li>Builder（抽象建造者）</li><li><code>ConcreteBuilder</code>（具体建造者）</li><li>Director（指挥者）</li></ul><p><img src="https://ybvip.oss-cn-shanghai.aliyuncs.com/blog/1576744283673.png" alt></p><h4 id="建造者模式（举例）">*建造者模式（举例）</h4><p><img src="https://ybvip.oss-cn-shanghai.aliyuncs.com/blog/1576744458688.png" alt></p><p>需要生产的产品</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yb;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CREATE BY YB ON 2019/12/19 16:12</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">People</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String head;</span><br><span class="line">    <span class="keyword">private</span> String body;</span><br><span class="line">    <span class="keyword">private</span> String hand;</span><br><span class="line">    <span class="keyword">private</span> String leg;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"People&#123;"</span> +</span><br><span class="line">                <span class="string">"head='"</span> + head + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", body='"</span> + body + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", hand='"</span> + hand + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", leg='"</span> + leg + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getHead</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHead</span><span class="params">(String head)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.head = head;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getBody</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> body;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBody</span><span class="params">(String body)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.body = body;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getHand</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> hand;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHand</span><span class="params">(String hand)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.hand = hand;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getLeg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> leg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLeg</span><span class="params">(String leg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.leg = leg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>抽象建造者</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yb;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CREATE BY YB ON 2019/12/19 15:27</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AbstractPeopleBuilder</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">createBody</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">createHand</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">createHead</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">createLeg</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">People <span class="title">getPeople</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>具体建造者</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yb;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CREATE BY YB ON 2019/12/19 15:31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FatPeopleBuilder</span> <span class="keyword">implements</span> <span class="title">AbstractPeopleBuilder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> People people = <span class="keyword">new</span> People();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createBody</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        people.setBody(<span class="string">"胖子的身体"</span>);</span><br><span class="line">        System.out.println(<span class="string">"创建胖子的身体"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createHand</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        people.setHand(<span class="string">"胖子的手"</span>);</span><br><span class="line">        System.out.println(<span class="string">"创建胖子的手"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createHead</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        people.setHead(<span class="string">"胖子的头"</span>);</span><br><span class="line">        System.out.println(<span class="string">"创建胖子的头"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createLeg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        people.setLeg(<span class="string">"胖子的腿"</span>);</span><br><span class="line">        System.out.println(<span class="string">"创建胖子的腿"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> People <span class="title">getPeople</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> people;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yb;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CREATE BY YB ON 2019/12/19 15:31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThinPeopleBuilder</span> <span class="keyword">implements</span> <span class="title">AbstractPeopleBuilder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> People people = <span class="keyword">new</span> People();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createBody</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        people.setHead(<span class="string">"瘦子的身体"</span>);</span><br><span class="line">        System.out.println(<span class="string">"创建瘦子的身体"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createHand</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        people.setBody(<span class="string">"瘦子的手"</span>);</span><br><span class="line">        System.out.println(<span class="string">"创建瘦子的手"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createHead</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        people.setHand(<span class="string">"瘦子的头"</span>);</span><br><span class="line">        System.out.println(<span class="string">"创建瘦子的头"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createLeg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        people.setLeg(<span class="string">"瘦子的腿"</span>);</span><br><span class="line">        System.out.println(<span class="string">"创建瘦子的腿"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> People <span class="title">getPeople</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> people;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>指挥者</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yb;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CREATE BY YB ON 2019/12/19 15:36</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PeopleDirector</span> </span>&#123;</span><br><span class="line">    AbstractPeopleBuilder peopleBuilder = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PeopleDirector</span><span class="params">(AbstractPeopleBuilder abstractPeopleBuilder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.peopleBuilder = abstractPeopleBuilder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPeopleBuilder</span><span class="params">(AbstractPeopleBuilder abstractPeopleBuilder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.peopleBuilder = abstractPeopleBuilder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> People <span class="title">createPeople</span><span class="params">()</span></span>&#123;</span><br><span class="line">        peopleBuilder.createHead();</span><br><span class="line">        peopleBuilder.createBody();</span><br><span class="line">        peopleBuilder.createHand();</span><br><span class="line">        peopleBuilder.createLeg();</span><br><span class="line">        <span class="keyword">return</span> peopleBuilder.getPeople();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>客户端</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yb;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CREATE BY YB ON 2019/12/19 15:38</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建生产胖子的具体建造者</span></span><br><span class="line">        FatPeopleBuilder fatPeopleBuilder = <span class="keyword">new</span> FatPeopleBuilder();</span><br><span class="line">        <span class="comment">// 指挥者</span></span><br><span class="line">        PeopleDirector peopleDirector = <span class="keyword">new</span> PeopleDirector(fatPeopleBuilder);</span><br><span class="line">        <span class="comment">// 创建胖子</span></span><br><span class="line">        People fat = peopleDirector.createPeople();</span><br><span class="line">        <span class="comment">// 输出胖子（产品）</span></span><br><span class="line">        System.out.println(fat);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建生产瘦子的具体建造者</span></span><br><span class="line">        ThinPeopleBuilder thinPeopleBuilder = <span class="keyword">new</span> ThinPeopleBuilder();</span><br><span class="line">        <span class="comment">// 通过set方法通知指挥者更改生产类型，生产瘦子</span></span><br><span class="line">        peopleDirector.setPeopleBuilder(thinPeopleBuilder);</span><br><span class="line">        <span class="comment">// 创建瘦子</span></span><br><span class="line">        People thin = peopleDirector.createPeople();</span><br><span class="line">        <span class="comment">// 得到瘦子（产品）</span></span><br><span class="line">        System.out.println(thin);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>具体应用举例</p><ul><li><p><code>JDK</code>的<code>StringBuilder</code></p><ul><li><pre><code class="language-java">package com.yb.example;

/**
 * CREATE BY YB ON 2019/12/19 17:38
 */
public class StringBuilderTest {
    public static void main(String[] args) {
        StringBuilder sb = new StringBuilder(&quot;hello world!&quot;);
        System.out.println(sb);
    }
}

<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 进入<span class="type">StringBuilder</span></span><br><span class="line"></span><br><span class="line">  ````java</span><br><span class="line">  public final class <span class="type">StringBuilder</span></span><br><span class="line">      extends <span class="type">AbstractStringBuilder</span></span><br><span class="line">      implements java.io.<span class="type">Serializable</span>, <span class="type">CharSequence</span></span><br><span class="line">  <span class="meta">&#123;...&#125;</span></span><br></pre></td></tr></table></figure>

</code></pre></li><li><p>进入<code>AbstractStringBuilder</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractStringBuilder</span> <span class="keyword">implements</span> <span class="title">Appendable</span>, <span class="title">CharSequence</span> </span>&#123;...&#125;</span><br></pre></td></tr></table></figure></li><li><p>进入<code>Appendable</code>，可以看到有三个抽象方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Appendable <span class="title">append</span><span class="params">(CharSequence csq)</span> <span class="keyword">throws</span> IOException</span>;</span><br><span class="line"><span class="function">Appendable <span class="title">append</span><span class="params">(CharSequence csq, <span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> <span class="keyword">throws</span> IOException</span>;</span><br><span class="line"><span class="function">Appendable <span class="title">append</span><span class="params">(<span class="keyword">char</span> c)</span> <span class="keyword">throws</span> IOException</span>;</span><br></pre></td></tr></table></figure></li><li><p>分析</p><ul><li><code>Appendable</code>接口定义了多个append方法（抽象方法），即<code>Appendable</code>为抽象建造者，定义了抽象方法</li><li><code>AbstractStringBuilder</code>实现了<code>Appendable</code>接口方法，这里的<code>AbstractStringBuilder</code>已经是建造者，只是不能实例化</li><li><code>StringBuilder</code>即充当了指挥者角色，同时充当了具体的建造者，建造方法是由<code>AbstractStringBuilder</code>完成，<code>StringBuilder</code>继承了<code>AbstractStringBuilder</code></li></ul></li></ul></li><li><p>具体的业务：短信模板</p><p><img src="https://ybvip.oss-cn-shanghai.aliyuncs.com/blog/1576749101780.png" alt></p></li></ul><h4 id="注意事项和细节-2">注意事项和细节</h4><ul><li>每个具体建造者都相对独立，可以很方便的替换具体建造者和增加新的具体建造者，用户使用不同的具体建造者即可得到不同的产品对象</li><li>可以更加精细的控制产品的创建过程</li><li>指挥者针对抽象建造者编程，系统扩展方便，符合开闭原则</li><li>建造者所创建的产品一般具有较多的共同点，如果产品差异很大,不适合用建造者</li></ul><h4 id="抽象工厂VS建造者模式">抽象工厂VS建造者模式</h4><p>抽象工厂模式实现对产品家族的创建，一个产品家族是这样的一系列产品：具有不同维度的产品组合，采用抽象工厂模式不需要关心构建过程，只关心什么产品由什么工厂生产即可。即建造者模式则是要求按照指定的蓝图建造产品，他的主要目的是通过组装零配件而产生一个新产品</p><h3 id="5-适配器模式">5.适配器模式</h3><h4 id="类适配器">*类适配器</h4><p>以类给到，在Adapter中，就是将src（source被适配的类）当作类，继承</p><p>[目标为dst,destination]</p><h4 id="对象适配器">*对象适配器</h4><p>以对象给到，在Adapter中，将src作为一个对象，持有（组合或者聚合的方式）</p><h4 id="接口适配器">*接口适配器</h4><p>以接口给到，在Adapter里，将src作为一个接口，实现</p><h4 id="具体应用">具体应用</h4><ul><li><p><code>SpringMVC</code>用到了适配器</p></li><li><p>使用<code>HandlerAdapter</code>的原因分析：</p><ul><li>可以看到处理器的类型不同，有多重实现方式，那么调用方式就是不确定的。如果需要直接调用Controller方法，需要调用的时候就是得不断使用if else来进行判断是哪一种子类然后执行。那么如果后面要扩展Controller，就得修改原来的代码，这样违背了OCP开闭原则</li></ul></li></ul><p><img src="https://ybvip.oss-cn-shanghai.aliyuncs.com/blog/1577064115158.png" alt></p><h4 id="注意事项和细节-3">注意事项和细节</h4><ul><li>Adapter模式最大的作用还是将原本不兼容的接口融合在一起</li><li>实际开发中，实现起来不拘泥于这三种经典形式</li></ul><h3 id="6-代理模式">6.代理模式</h3><ul><li><p>基本介绍</p><ul><li>为一个对象提供一个替身，以控制对这个对象的访问。即通过代理对象访问目标对象</li><li>好处：可以在目标对象实现的基础上，增加额外的功能操作，即扩展目标对象的功能</li><li>目标：被代理的对象可以是远程对象、创建开销大的对象或者需要安全控制的对象</li></ul></li><li><p>静态代理</p></li><li><p>动态代理</p><ul><li>JDK代理：接口代理</li><li>Cglib代理 ：可以在内存动态的创建对象，而不需要实现接口</li></ul></li></ul><h4 id="静态代理">静态代理</h4><p><img src="https://ybvip.oss-cn-shanghai.aliyuncs.com/blog/1577069470978.png" alt></p><p>代码实现</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yb.staticproxy;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CREATE BY YB ON 2019/12/23 10:21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ITeacherDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">teach</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yb.staticproxy;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CREATE BY YB ON 2019/12/23 10:21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeacherDao</span> <span class="keyword">implements</span> <span class="title">ITeacherDao</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">teach</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"教书..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yb.staticproxy;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CREATE BY YB ON 2019/12/23 10:21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyTeacherDao</span> <span class="keyword">implements</span> <span class="title">ITeacherDao</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 目标对象</span></span><br><span class="line">    <span class="keyword">private</span> ITeacherDao target;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ProxyTeacherDao</span><span class="params">(ITeacherDao teacherDao)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.target = teacherDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">teach</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"开始代理..."</span>);</span><br><span class="line">        target.teach();</span><br><span class="line">        System.out.println(<span class="string">"代理结束"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yb.staticproxy;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CREATE BY YB ON 2019/12/23 10:26</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建目标对象</span></span><br><span class="line">        TeacherDao teacherDao = <span class="keyword">new</span> TeacherDao();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 代理对象开始代理目标对象</span></span><br><span class="line">        <span class="keyword">new</span> ProxyTeacherDao(teacherDao).teach();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>优点：在不修改目标对象的功能前提下，能通过代理对象对目标功能扩展</p><p>缺点：因为代理对象需要与目标对象实现一样的接口，所以会有很对代理类；一旦接口增加方法，目标对象与代理对象都要维护</p><h4 id="动态代理">动态代理</h4><ul><li>代理对象不需要实现接口，但是目标对象要实现接口，否则不能用动态代理</li><li>代理对象生成，是利用JDK的API，动态的在内存中构建代理对象</li><li>动态代理也叫做：JDK代理，接口代理</li><li>代理类所在的包:java.lang.reflect.Proxy</li><li>JDK实现代理只需要使用newProxyInstance方法</li></ul><h5 id="JDK代理">JDK代理</h5><ul><li>和静态代理相比，jdk代理代理对象不需要实现接口，代理对象构造器不需要根据父类接口类型传参，而是穿个object对象，然后通过反射去获取实例就行了（好处就是，代理方法写一个就可以了（前后增强都是一样的），不像静态代理代理多个时需要增加多个方法）</li></ul><p><img src="https://ybvip.oss-cn-shanghai.aliyuncs.com/blog/1577072320143.png" alt></p><h5 id="Cglib代理">Cglib代理</h5><ul><li>有时候目标对象仅仅是一个单独的类，而没有实现任何接口，此时jdk代理就不能用了，因为jdk代理类（不需要实现任何接口）要求目标对象必须有接口。（但是cglib代理类需要实现cglib自己的接口实现一个拦截的方法）</li><li>广泛被许多AOP框架使用，例如SpringAOP，实现方法拦截AOP应用场景<br>场景一： 记录日志<br>场景二： 监控方法运行时间 （监控性能）<br>场景三： 权限控制<br>场景四： 缓存优化 （第一次调用查询数据库，将查询结果放入内存对象， 第二次调用， 直接从内存对象返回，不需要查询数据库 ）<br>场景五： 事务管理 （调用方法前开启事务， 调用方法后提交关闭事务 ）</li><li>AOP编程中如何使用代理模式<ul><li>目标对象需要实现接口，用JDK代理</li><li>目标对象不需要实现接口，用Cglib代理</li></ul></li><li>目标类不能为final类（final类不能被继承，cglib使用了继承）</li><li>目标类的方法如果是final/static，也不会拦截</li></ul><p><img src="https://ybvip.oss-cn-shanghai.aliyuncs.com/blog/1586856884138.png" alt></p><h4 id="区别">区别</h4><h5 id="JDK动态代理和CGLIB代理生成的区别">JDK动态代理和CGLIB代理生成的区别</h5><p>JDK动态代理只能对实现了接口的类生成代理，而不能针对类 。<br>CGLIB是针对类实现代理，主要是对指定的类生成一个子类，覆盖其中的方法 。<br>因为是继承，所以该类或方法最好不要声明成final ，final可以阻止继承和多态。</p><h5 id="两者速度对比">两者速度对比</h5><p>JDK动态代理是面向接口，在创建代理实现类时比CGLib要快，创建代理速度快。<br>CGLib动态代理是通过字节码底层继承要代理类来实现（如果被代理类被final关键字所修饰，那么抱歉会失败），在创建代理这一块没有JDK动态代理快，但是运行速度比JDK动态代理要快。</p><p><strong>PS：</strong></p><ul><li>final 所修饰的数据具有“终态”的特征，表示“最终的”意思：</li><li>final 修饰的类不能被继承。</li><li>final 修饰的方法不能被子类重写。</li><li>final 修饰的变量（成员变量或局部变量）即成为常量，只能赋值一次。</li><li>final 修饰的成员变量必须在声明的同时赋值，如果在声明的时候没有赋值，那么只有 一次赋值的机会，而且只能在构造方法中显式赋值，然后才能使用。</li><li>final 修饰的局部变量可以只声明不赋值，然后再进行一次性的赋值。</li></ul><h4 id="变体">变体</h4><p>了解即可</p><h5 id="防火墙代理">防火墙代理</h5><p>内网穿透</p><h5 id="缓存代理">缓存代理</h5><p>资源先到代理中取，取不到再到公网或者数据库取</p><h5 id="远程代理">远程代理</h5><p>把远程对象当本地对象来调用</p><h5 id="同步代理">同步代理</h5><p>在多线程编程中，完成多线程间同步工作，比如多人通过代理点购买火车票</p></escape></escape><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script></div><div class="reward-container"><div>您的支持将鼓励我继续创作!</div><button disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">打赏</button><div id="qr" style="display:none"><div style="display:inline-block"><img src="/images/wechatpay.png" alt="YB 微信支付"><p>微信支付</p></div><div style="display:inline-block"><img src="/images/alipay.png" alt="YB 支付宝"><p>支付宝</p></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag"><i class="fa fa-tag"></i> 设计模式</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/1949806585/" rel="prev" title="搜索引擎/ElasticSearch/ElasticSearch  的安装 及 整合Springdata"><i class="fa fa-chevron-left"></i> 搜索引擎/ElasticSearch/ElasticSearch 的安装 及 整合Springdata</a></div><div class="post-nav-item"><a href="/posts/239291847/" rel="next" title="博客/WordPress/WordPress建站">博客/WordPress/WordPress建站 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments" id="comments"></div></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#null"><span class="nav-text">设计模式系统学习</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#七大原则"><span class="nav-text">七大原则</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#静态代码块"><span class="nav-text">静态代码块</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#懒汉式（3种）"><span class="nav-text">* 懒汉式（3种）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#懒汉式（线程不安全）"><span class="nav-text">懒汉式（线程不安全）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#懒汉式（线程安全）"><span class="nav-text">懒汉式（线程安全）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#懒汉式（同步代码块，不安全-）"><span class="nav-text">懒汉式（同步代码块，不安全 ）</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#双重检查（推荐）"><span class="nav-text">* 双重检查（推荐）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#静态内部类（推荐）"><span class="nav-text">* 静态内部类（推荐）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#枚举（推荐）"><span class="nav-text">* 枚举（推荐）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#具体应用举例"><span class="nav-text">具体应用举例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#注意事项和细节说明"><span class="nav-text">注意事项和细节说明</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-工厂模式"><span class="nav-text">2.工厂模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#简单工厂模式"><span class="nav-text">* 简单工厂模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#工厂方法模式"><span class="nav-text">* 工厂方法模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#抽象工厂模式"><span class="nav-text">* 抽象工厂模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#具体应用举例-2"><span class="nav-text">具体应用举例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#工厂模式总结"><span class="nav-text">工厂模式总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-原型模式"><span class="nav-text">3.原型模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#传统方式"><span class="nav-text">传统方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#原型模式（浅拷贝）"><span class="nav-text">* 原型模式（浅拷贝）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#深拷贝"><span class="nav-text">深拷贝</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#具体应用举例-3"><span class="nav-text">具体应用举例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#深入讨论—浅拷贝和深拷贝"><span class="nav-text">深入讨论—浅拷贝和深拷贝</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#注意事项和细节"><span class="nav-text">注意事项和细节</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-建造者模式"><span class="nav-text">4.建造者模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#建造者模式的四个角色"><span class="nav-text">建造者模式的四个角色</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#建造者模式（举例）"><span class="nav-text">*建造者模式（举例）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#注意事项和细节-2"><span class="nav-text">注意事项和细节</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#抽象工厂VS建造者模式"><span class="nav-text">抽象工厂VS建造者模式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-适配器模式"><span class="nav-text">5.适配器模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#类适配器"><span class="nav-text">*类适配器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#对象适配器"><span class="nav-text">*对象适配器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#接口适配器"><span class="nav-text">*接口适配器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#具体应用"><span class="nav-text">具体应用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#注意事项和细节-3"><span class="nav-text">注意事项和细节</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-代理模式"><span class="nav-text">6.代理模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#静态代理"><span class="nav-text">静态代理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#动态代理"><span class="nav-text">动态代理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#JDK代理"><span class="nav-text">JDK代理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Cglib代理"><span class="nav-text">Cglib代理</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#区别"><span class="nav-text">区别</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#JDK动态代理和CGLIB代理生成的区别"><span class="nav-text">JDK动态代理和CGLIB代理生成的区别</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#两者速度对比"><span class="nav-text">两者速度对比</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#变体"><span class="nav-text">变体</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#防火墙代理"><span class="nav-text">防火墙代理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#缓存代理"><span class="nav-text">缓存代理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#远程代理"><span class="nav-text">远程代理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#同步代理"><span class="nav-text">同步代理</span></a></li></ol></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="YB" src="/images/avatar.gif"><p class="site-author-name" itemprop="name">YB</p><div class="site-description" itemprop="description">年岁是我的闹钟</div></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/Boy2ang" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Boy2ang" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i></a> </span><span class="links-of-author-item"><a href="mailto:ybvip@outlook.com" title="E-Mail → mailto:ybvip@outlook.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i></a> </span><span class="links-of-author-item"><a href="https://weibo.com/yourname" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i></a> </span><span class="links-of-author-item"><a href="https://plus.google.com/yourname" title="Google → https:&#x2F;&#x2F;plus.google.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fa fa-fw fa-google"></i></a> </span><span class="links-of-author-item"><a href="https://twitter.com/yourname" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i></a> </span><span class="links-of-author-item"><a href="https://www.facebook.com/yourname" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fa fa-fw fa-facebook"></i></a></span></div></div><div><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="350" height="100" src="//music.163.com/outchain/player?type=2&id=470795480&auto=1&height=66"></iframe></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-history fa-" aria-hidden="true"></i> 近期文章</div><ul class="links-of-blogroll-list"><li><a href="/" target="_blank"></a></li><li><a href="/" target="_blank"></a></li><li><a href="/" target="_blank"></a></li><li><a href="/" target="_blank"></a></li><li><a href="/" target="_blank"></a></li></ul></div><div><canvas id="canvas" style="width:60%">当前浏览器不支持canvas，请更换浏览器后再试</canvas></div><script>!function(){function t(t,e){for(var a=0;a<l[e].length;a++)for(var n=0;n<l[e][a].length;n++)1==l[e][a][n]&&(h.beginPath(),h.arc(14*(g+2)*t+2*n*(g+1)+(g+1),2*a*(g+1)+(g+1),g,0,2*Math.PI),h.closePath(),h.fill())}function e(){var t=[],e=/(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date),a=[];a.push(e[1],e[2],10,e[3],e[4],10,e[5],e[6]);for(var r=c.length-1;r>=0;r--)a[r]!==c[r]&&t.push(r+"_"+(Number(c[r])+1)%10);for(var r=0;r<t.length;r++)n.apply(this,t[r].split("_"));c=a.concat()}function a(){for(var t=0;t<d.length;t++)d[t].stepY+=d[t].disY,d[t].x+=d[t].stepX,d[t].y+=d[t].stepY,(d[t].x>i+g||d[t].y>f+g)&&(d.splice(t,1),t--)}function n(t,e){for(var a=[1,2,3],n=["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"],r=0;r<l[e].length;r++)for(var o=0;o<l[e][r].length;o++)if(1==l[e][r][o]){var h={x:14*(g+2)*t+2*o*(g+1)+(g+1),y:2*r*(g+1)+(g+1),stepX:Math.floor(4*Math.random()-2),stepY:-2*a[Math.floor(Math.random()*a.length)],color:n[Math.floor(Math.random()*n.length)],disY:1};d.push(h)}}function r(){o.height=100;for(var e=0;e<c.length;e++)t(e,c[e]);for(var e=0;e<d.length;e++)h.beginPath(),h.arc(d[e].x,d[e].y,g,0,2*Math.PI),h.fillStyle=d[e].color,h.closePath(),h.fill()}var l=[[[0,0,1,1,1,0,0],[0,1,1,0,1,1,0],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,0,1,1,0],[0,0,1,1,1,0,0]],[[0,0,0,1,1,0,0],[0,1,1,1,1,0,0],[0,0,0,1,1,0,0],[0,0,0,1,1,0,0],[0,0,0,1,1,0,0],[0,0,0,1,1,0,0],[0,0,0,1,1,0,0],[0,0,0,1,1,0,0],[0,0,0,1,1,0,0],[1,1,1,1,1,1,1]],[[0,1,1,1,1,1,0],[1,1,0,0,0,1,1],[0,0,0,0,0,1,1],[0,0,0,0,1,1,0],[0,0,0,1,1,0,0],[0,0,1,1,0,0,0],[0,1,1,0,0,0,0],[1,1,0,0,0,0,0],[1,1,0,0,0,1,1],[1,1,1,1,1,1,1]],[[1,1,1,1,1,1,1],[0,0,0,0,0,1,1],[0,0,0,0,1,1,0],[0,0,0,1,1,0,0],[0,0,1,1,1,0,0],[0,0,0,0,1,1,0],[0,0,0,0,0,1,1],[0,0,0,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,1,1,1,0]],[[0,0,0,0,1,1,0],[0,0,0,1,1,1,0],[0,0,1,1,1,1,0],[0,1,1,0,1,1,0],[1,1,0,0,1,1,0],[1,1,1,1,1,1,1],[0,0,0,0,1,1,0],[0,0,0,0,1,1,0],[0,0,0,0,1,1,0],[0,0,0,1,1,1,1]],[[1,1,1,1,1,1,1],[1,1,0,0,0,0,0],[1,1,0,0,0,0,0],[1,1,1,1,1,1,0],[0,0,0,0,0,1,1],[0,0,0,0,0,1,1],[0,0,0,0,0,1,1],[0,0,0,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,1,1,1,0]],[[0,0,0,0,1,1,0],[0,0,1,1,0,0,0],[0,1,1,0,0,0,0],[1,1,0,0,0,0,0],[1,1,0,1,1,1,0],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,1,1,1,0]],[[1,1,1,1,1,1,1],[1,1,0,0,0,1,1],[0,0,0,0,1,1,0],[0,0,0,0,1,1,0],[0,0,0,1,1,0,0],[0,0,0,1,1,0,0],[0,0,1,1,0,0,0],[0,0,1,1,0,0,0],[0,0,1,1,0,0,0],[0,0,1,1,0,0,0]],[[0,1,1,1,1,1,0],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,1,1,1,0],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,1,1,1,0]],[[0,1,1,1,1,1,0],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,1,0,1,1],[0,0,0,0,0,1,1],[0,0,0,0,0,1,1],[0,0,0,0,1,1,0],[0,0,0,1,1,0,0],[0,1,1,0,0,0,0]],[[0,0,0,0,0,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,0,0,0,0,0]]],o=document.getElementById("canvas");if(o.getContext){var h=o.getContext("2d"),f=100,i=700;o.height=f,o.width=i,h.fillStyle="#f00",h.fillRect(10,10,50,50);var c=[],d=[],g=o.height/20-1;!function(){var t=/(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date);c.push(t[1],t[2],10,t[3],t[4],10,t[5],t[6])}(),clearInterval(v);var v=setInterval(function(){e(),a(),r()},50)}}()</script></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2018 – <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">YB</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv">我的第 <span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 位朋友， </span><span class="agesicon"><span><span class="site-pv">历经 <span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 次回眸才与你相遇。</span></span></span></div><script>function leancloudSelector(url) {
    return document.getElementById(url).querySelector('.leancloud-visitors-count');
  }
  if (CONFIG.page.isPost) {
    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = visitors.getAttribute('id').trim();
      var title = visitors.getAttribute('data-flag-title').trim();

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
              leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .then(response => response.json())
              .catch(error => {
                console.log('Failed to save visitor count', error);
              })
          } else {
              Counter('post', '/classes/Counter', { title: title, url: url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.log('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.log('LeanCloud Counter Error', error);
        });
    }
  } else {
    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return element.getAttribute('id').trim();
      });

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url: { '$in': entries } })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length === 0) {
            document.querySelectorAll('.leancloud_visitors .leancloud-visitors-count').forEach(element => {
              element.innerText = 0;
            });
            return;
          }
          for (let item of results) {
            let { url, time } = item;
            leancloudSelector(url).innerText = time;
          }
          for (let url of entries) {
            var element = leancloudSelector(url);
            if (element.innerText == '') {
              element.innerText = 0;
            }
          }
        })
        .catch(error => {
          console.log('LeanCloud Counter Error', error);
        });
    }
  }

  fetch('https://app-router.leancloud.cn/2/route?appId=iknoyPikdeJOSWsuQYwaAT8s-gzGzoHsz')
    .then(response => response.json())
    .then(({ api_server }) => {
      var Counter = (method, url, data) => {
        return fetch(`https://${api_server}/1.1${url}`, {
          method: method,
          headers: {
            'X-LC-Id': 'iknoyPikdeJOSWsuQYwaAT8s-gzGzoHsz',
            'X-LC-Key': 'a7k7hVy9GzeC2qRlWDGktNRn',
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    });</script></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="150" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script>NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(item => {
    return GUEST.includes(item);
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: 'iknoyPikdeJOSWsuQYwaAT8s-gzGzoHsz',
    appKey: 'a7k7hVy9GzeC2qRlWDGktNRn',
    placeholder: "说点什么吧。",
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false,
    lang: '' || 'zh-cn',
    path: location.pathname,
    recordIP: false,
    serverURLs: ''
  });
}, window.Valine);</script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/moment.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment-precise-range-plugin@1.3.0/moment-precise-range.min.js"></script><script>function timer() {
      var ages = moment.preciseDiff(moment(),moment(20181001,"YYYYMMDD"));
      //去除时分秒信息
      ages = ages.replace(/\s?\d{0,2}\s+hours?/, "");
      ages = ages.replace(/\s?\d{0,2}\s+minutes?/, "");
      ages = ages.replace(/\s?\d{0,2}\s+seconds?/, "");
      //将年月日转换为中文
      ages = ages.replace(/years?/, "年");
      ages = ages.replace(/months?/, "月");
      ages = ages.replace(/days?/, "天");
      ages = ages.replace(/\d+/g, '<span style="color:#1094e8">$&</span>');
      span.innerHTML = ` &nbsp; | &nbsp;我已在此等候你 ${ages}`;
    }
    var span = document.createElement("span");
    //插入到agesicon之后
    var agesicon = document.querySelector(".agesicon");
    document.querySelector(".copyright").insertBefore(span, agesicon.nextSibling);
    timer();</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,log:!1,model:{jsonPath:"/live2dw/assets/koharu.model.json"},display:{position:"right",width:200,height:400},mobile:{show:!0},react:{opacity:.7}})</script></body></html><!-- rebuild by neat -->